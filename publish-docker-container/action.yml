name: "Reusable Docker Publish Workflow"
description: "Build and publish Docker images to Docker Hub and GitHub Container Registry."

inputs:
  docker_image_name:
    description: "The name of the Docker image to build and publish"
    required: true
    type: string

env:
  DOCKERHUB_USERNAME:
    description: "Docker Hub username for login"
    required: true
  DOCKERHUB_TOKEN:
    description: "Docker Hub token or password for login"
    required: true
  GHCR_TOKEN:
    description: "GitHub token for publishing to GitHub Container Registry"
    required: true

runs:
  using: "composite"
  steps:
    - name: Build Docker image
      uses: ./build-docker-container
      with:
        docker_image_name: ${{ inputs.docker_image_name }}
      env:
        DOCKERHUB_USERNAME: ${{ env.DOCKERHUB_USERNAME }}

    - name: Publish Docker image to Docker Hub
      uses: ./publish-container-docker-hub
      with:
        docker_image_name: ${{ inputs.docker_image_name }}
      env:
        DOCKERHUB_USERNAME: ${{ env.DOCKERHUB_USERNAME }}
        DOCKERHUB_TOKEN: ${{ env.DOCKERHUB_TOKEN }}

    - name: Publish Docker image to GitHub Container Registry
      uses: ./publish-container-github
      with:
        docker_image_name: ${{ inputs.docker_image_name }}
      env:
        GHCR_TOKEN: ${{ env.GHCR_TOKEN }}